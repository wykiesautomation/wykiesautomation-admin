<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Wykies Automation — Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="admin.css"/>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="config.js"></script>
  <script src="paymentsApi.js" defer></script>
  <script src="productsApi.js" defer></script>
  <script src="invoicesApi.js" defer></script>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <h1 class="brand">Wykies Automation — Admin</h1>
      <div class="top-actions">
        <a class="btn link" href="/docs" target="_blank" rel="noopener">View Docs</a>
        <a class="btn link" href="/download" target="_blank" rel="noopener">Download Trial</a>
        <a class="btn primary" href="https://wa.me/27716816131" target="_blank" rel="noopener">WhatsApp</a>
      </div>
    </div>
  </header>

  <main class="page">
    <section class="auth-gate" id="authGate">
      <div class="auth-inner">
        <div class="auth-status">
          <strong>Status:</strong>
          <span id="authStatus">Signed out</span>
          <span class="badge" id="authEmail"></span>
        </div>
        <div class="controls">
          <div id="googleBtn"></div>
          <button class="btn outline" id="btnSignOut" disabled>Sign out</button>
          <span class="muted">Only allowlisted Google account can access Admin.</span>
        </div>
      </div>
    </section>

    <section class="tab-panel" id="tabProducts" hidden>
      <div class="panel-header">
        <h2>Products</h2>
        <div class="controls">
          <input id="prodSearch" type="search" placeholder="Search products (name, SKU)"/>
          <select id="prodSort">
            <option value="name_asc">Name (A–Z)</option>
            <option value="name_desc">Name (Z–A)</option>
            <option value="price_desc">Price (high→low)</option>
            <option value="price_asc">Price (low→high)</option>
            <option value="sku_asc">SKU (A–Z)</option>
            <option value="sku_desc">SKU (Z–A)</option>
            <option value="updated_desc">Updated (newest)</option>
          </select>
          <button class="btn" id="btnNewProduct">Add Product</button>
          <button class="btn outline" id="btnExportProducts">Export CSV</button>
          <button class="btn" id="btnPublish">Publish to Public Site</button>
        </div>
      </div>
      <div class="table-wrap">
        <table class="data-table" id="prodTable">
          <thead>
            <tr>
              <th>Thumbnail</th>
              <th>SKU</th>
              <th>Name</th>
              <th>Price (incl.)</th>
              <th>Updated</th>
              <th>Images</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="prodRows"></tbody>
        </table>
      </div>
      <div class="pager">
        <button class="btn small" id="prodPrev">◀ Prev</button>
        <span id="prodPageInfo">Page 1</span>
        <button class="btn small" id="prodNext">Next ▶</button>
      </div>
    </section>

    <section class="tab-panel" id="tabPayments" hidden>
      <div class="panel-header">
        <h2>Payments</h2>
        <div class="controls">
          <input id="paySearch" type="search" placeholder="Search payments"/>
          <select id="paySort">
            <option value="timestamp_desc">Newest first</option>
            <option value="timestamp_asc">Oldest first</option>
          </select>
          <button class="btn outline" id="btnExportCsv">Export CSV</button>
          <button class="btn outline" id="btnExportXlsx">Export XLSX</button>
        </div>
      </div>
      <div class="table-wrap">
        <table class="data-table">
          <thead>
            <tr>
              <th>Timestamp</th><th>Invoice</th><th>Order ID</th><th>pf_payment_id</th>
              <th>Email</th><th>SKU</th><th>Total (incl.)</th><th>Released</th><th>PDF</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="payRows"></tbody>
        </table>
      </div>
      <div class="pager">
        <button class="btn small" id="prevPage">◀ Prev</button>
        <span id="pageInfo">Page 1</span>
        <button class="btn small" id="nextPage">Next ▶</button>
      </div>
    </section>

    <section class="tab-panel" id="tabInvoices" hidden>
      <div class="panel-header">
        <h2>Invoices</h2>
        <div class="controls">
          <input id="invSearch" type="search" placeholder="Search (invoice, email, customer)"/>
          <select id="invSort">
            <option value="date_desc">Date (newest)</option>
            <option value="date_asc">Date (oldest)</option>
            <option value="total_desc">Total (high→low)</option>
            <option value="total_asc">Total (low→high)</option>
            <option value="paid_desc">Paid (yes→no)</option>
          </select>
          <button class="btn" id="btnNewInvoice">New Invoice</button>
          <button class="btn outline" id="btnExportInvoices">Export CSV</button>
        </div>
      </div>

      <div class="table-wrap">
        <table class="data-table">
          <thead>
            <tr>
              <th>Invoice</th><th>Date</th><th>Customer</th><th>Email</th>
              <th>Subtotal</th><th>VAT</th><th>Total (incl.)</th><th>Paid</th><th>PDF</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="invRows"></tbody>
        </table>
      </div>
      <div class="pager">
        <button class="btn small" id="invPrev">◀ Prev</button>
        <span id="invPageInfo">Page 1</span>
        <button class="btn small" id="invNext">Next ▶</button>
      </div>
    </section>

    <div class="toast hidden" id="toast"><span id="toast-text">Ready.</span></div>
  </main>

  <!-- Product dialog -->
  <dialog id="prodDialog">
    <form method="dialog" id="prodForm">
      <h3 id="dlgTitle">New Product</h3>
      <div class="controls">
        <input id="fSku" placeholder="SKU" required />
        <input id="fName" placeholder="Name" required />
        <input id="fPrice" type="number" min="0" step="0.01" placeholder="Price incl. VAT" required />
      </div>
      <div class="controls">
        <input id="fImage" type="file" accept="image/*" multiple />
      </div>
      <div class="controls">
        <button class="btn" id="btnSaveProd">Save</button>
        <button class="btn outline" id="btnCancelProd">Cancel</button>
      </div>
    </form>
  </dialog>

  <!-- Invoice dialog -->
  <dialog id="invDialog">
    <form method="dialog" id="invForm">
      <h3 id="invDlgTitle">New Invoice</h3>
      <div class="controls">
        <input id="iInvoiceNo" placeholder="Invoice No (auto if empty)"/>
        <input id="iDate" type="date" />
      </div>
      <div class="controls">
        <input id="iCustomer" placeholder="Customer name" required />
        <input id="iEmail" type="email" placeholder="Customer email" required />
      </div>
      <div class="tab-panel">
        <h4>Items</h4>
        <div class="controls">
          <input id="iSku" placeholder="SKU"/>
          <input id="iName" placeholder="Item name"/>
          <input id="iQty" type="number" min="1" step="1" placeholder="Qty" />
          <input id="iUnit" type="number" min="0" step="0.01" placeholder="Unit (incl. VAT)"/>
          <button class="btn small" id="btnAddItem" type="button">Add</button>
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr><th>SKU</th><th>Name</th><th>Qty</th><th>Unit (incl.)</th><th>Line Total</th><th>Actions</th></tr>
            </thead>
            <tbody id="invItemRows"></tbody>
          </table>
        </div>
      </div>
      <div class="controls">
        <span class="badge">Subtotal: <strong id="invSubtotal">R 0.00</strong></span>
        <span class="badge">VAT (15%): <strong id="invVat">R 0.00</strong></span>
        <span class="badge">Total (incl.): <strong id="invTotal">R 0.00</strong></span>
      </div>
      <div class="controls">
        <button class="btn" id="btnSaveInvoice">Save</button>
        <button class="btn outline" id="btnCancelInvoice">Cancel</button>
      </div>
    </form>
  </dialog>
</body>
</html>
