<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wykies Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
  <header class="top">
    <div class="brand"><span class="logo">WA</span><span>Admin</span></div>
    <nav class="tabs">
      <a data-tab="dashboard" class="active">Dashboard</a>
      <a data-tab="catalog">Catalog</a>
      <a data-tab="prices">Price Log</a>
      <a data-tab="payments">Payments</a>
      <a data-tab="analytics">Analytics</a>
      <a data-tab="pages">Pages</a>
      <a data-tab="settings">Settings</a>
      <a data-tab="audit">Audit</a>
    </nav>
    <div class="auth">
      <div id="gbtn"></div>
      <button id="signOut" class="btn outline" disabled>Sign out</button>
      <span id="roleBadge" class="role">Viewer</span>
    </div>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab active">
      <h1>Dashboard</h1>
      <div class="cards">
        <div class="card"><div class="label">Today’s Sales</div><div id="todaySales" class="value">R 0</div></div>
        <div class="card"><div class="label">Verified ITNs (24h)</div><div id="itn24" class="value">0</div></div>
        <div class="card"><div class="label">Queue Health</div><div id="qHealth" class="value ok">OK</div></div>
      </div>
    </section>

    <!-- CATALOG -->
    <section id="tab-catalog" class="tab">
      <div class="row">
        <h1>Catalog</h1>
        <div class="spacer"></div>
        <button id="btnNewProduct" class="btn" data-role="Admin" disabled>Add Product</button>
      </div>
      <table class="grid" id="tblCatalog">
        <thead><tr><th>ID</th><th>Name</th><th>Price (incl VAT)</th><th>Images</th><th>Status</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- PRICE LOG -->
    <section id="tab-prices" class="tab">
      <div class="row">
        <h1>Price Log</h1>
        <div class="spacer"></div>
        <button id="btnExportCSV" class="btn outline">Export CSV</button>
      </div>
      <p class="muted">Append-only: product_id, old, new, who, when, note</p>
      <table class="grid" id="tblPrices">
        <thead><tr><th>When</th><th>Product</th><th>Old</th><th>New</th><th>Who</th><th>Note</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- PAYMENTS -->
    <section id="tab-payments" class="tab">
      <h1>Payments</h1>
      <table class="grid" id="tblPayments">
        <thead><tr><th>Date</th><th>Order</th><th>Email</th><th>Total</th><th>Status</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ANALYTICS -->
    <section id="tab-analytics" class="tab">
      <h1>Analytics</h1>
      <div class="cards">
        <div class="card"><div class="label">7‑Day Revenue</div><div id="rev7" class="value">R 0</div></div>
        <div class="card"><div class="label">Top Product</div><div id="topProd" class="value">—</div></div>
        <div class="card"><div class="label">Orders (7d)</div><div id="orders7" class="value">0</div></div>
      </div>
      <div class="grid2">
        <div class="panel">
          <h3>Revenue by Day (Last 30)</h3>
          <canvas id="cRevenue" width="900" height="240"></canvas>
        </div>
        <div class="panel">
          <h3>Sales by Product (Last 30)</h3>
          <canvas id="cProducts" width="900" height="240"></canvas>
        </div>
      </div>
    </section>

    <!-- PAGES -->
    <section id="tab-pages" class="tab">
      <h1>Pages (Markdown)</h1>
      <div class="row fields">
        <label>Slug<input id="pgSlug"></label>
        <label>Title<input id="pgTitle"></label>
      </div>
      <label>Content (Markdown)
        <textarea id="pgMd" rows="8">## Privacy (POPIA)
We collect contact and order details to process sales via PayFast…</textarea>
      </label>
      <div class="row">
        <button id="btnSavePage" class="btn" data-role="Admin" disabled>Save</button>
        <button id="btnPreviewPage" class="btn outline">Preview</button>
      </div>
      <h2>Preview</h2>
      <div id="pgPreview" class="preview"></div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="tab">
      <h1>Settings</h1>
      <div class="grid form">
        <label>Company Name<input id="setCompany"></label>
        <label>VAT Number<input id="setVat"></label>
        <label>Registered Address<textarea id="setAddr" rows="3"></textarea></label>
        <label>Support Email<input id="setEmail"></label>
        <label>Logo<input type="file" id="setLogo" accept="image/*"></label>
        <label>Brand Color<input id="setColor" type="color" value="#2F76FF"></label>
      </div>
      <button id="btnSaveSettings" class="btn" data-role="Admin" disabled>Save Settings</button>
    </section>

    <!-- AUDIT -->
    <section id="tab-audit" class="tab">
      <h1>Audit Log</h1>
      <table class="grid" id="tblAudit">
        <thead><tr><th>When</th><th>User</th><th>IP</th><th>Action</th><th>Target</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- Modal Dialogs (Edit + New) -->
  <div id="modalBackdrop" class="modal-backdrop" hidden></div>
  <div id="productModal" class="modal" hidden>
    <div class="modal-card">
      <div class="modal-header">
        <h3 id="modalTitle">Edit Product</h3>
        <button class="icon-btn" id="modalClose">✕</button>
      </div>
      <div class="modal-body">
        <form id="productForm">
          <div class="form-row">
            <label>Product ID
              <input name="id" id="fId" />
              <small class="hint">Use format like WA-01, WA-02…</small>
            </label>
            <label>Status
              <select name="status" id="fStatus">
                <option value="visible">visible</option>
                <option value="hidden">hidden</option>
              </select>
            </label>
          </div>
          <label>Name
            <input name="name" id="fName" required maxlength="120" />
          </label>
          <label>Price (VAT incl.)
            <input name="price" id="fPrice" inputmode="decimal" required />
          </label>
          <div id="imageRow" class="form-row" hidden>
            <label>Product Image (≤200KB)
              <input type="file" id="fImage" accept="image/*" />
            </label>
          </div>
          <label>Note (for Price Log)
            <input name="note" id="fNote" placeholder="Optional note e.g. Supplier increase" />
          </label>
        </form>
        <div id="formError" class="form-error" hidden></div>
      </div>
      <div class="modal-footer">
        <button class="btn outline" id="modalCancel">Cancel</button>
        <button class="btn" id="modalSave" data-role="Admin" disabled>Save</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" hidden></div>

  <footer class="foot">
    <span>Allowlist: <b>wykiesautomation@gmail.com</b></span>
    <span id="build">Build: visual-wired-analytics</span>
  </footer>

  <script type="module" src="assets/js/config.js"></script>
  <script type="module" src="assets/js/api.js"></script>
  <script type="module" src="assets/js/auth.js"></script>
  <script type="module" src="assets/js/nav.js"></script>
  <script type="module" src="assets/js/dialogs.js"></script>
  <script type="module" src="assets/js/export.js"></script>
  <script type="module" src="assets/js/analytics.js"></script>
  <script type="module" src="assets/js/admin.js"></script>
</body>
</html>