
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Wykies Automation — Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0e141b; --panel:#151c24; --text:#e6eef7; --muted:#9fb0c2;
      --primary:#174ea6; --accent:#ff3b5c; --border:#223040; --input:#0f1924;
      --success:#18b26b; --warn:#ffc107;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif}
    a{color:#69a7ff;text-decoration:none}
    header{
      position:sticky;top:0;z-index:10;background:var(--primary);
      color:#fff;display:flex;justify-content:space-between;align-items:center;
      padding:.75rem 1rem
    }
    header .title{font-weight:600}
    header nav a{margin-left:1rem;color:#d7e7ff}
    header nav a.active{font-weight:700;text-decoration:underline}
    main{padding:1rem;max-width:1100px;margin:0 auto}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
    .panel{
      background:var(--panel); border:1px solid var(--border); border-radius:10px; padding:1rem
    }
    h2{margin-top:0}
    label{display:block;font-size:.9rem;color:var(--muted);margin:.5rem 0 .25rem}
    input,textarea{
      width:100%; background:var(--input); color:var(--text);
      border:1px solid var(--border); border-radius:8px; padding:.6rem; outline:none
    }
    textarea{min-height:5.5rem;resize:vertical}
    button{
      appearance:none; border:0; border-radius:8px; padding:.55rem .9rem; cursor:pointer;
      color:#fff; background:var(--accent); font-weight:600
    }
    button.secondary{background:#345678}
    button.success{background:var(--success)}
    .row{display:flex;gap:.75rem;align-items:center}
    .hidden{display:none}
    .toast{
      position:fixed;right:1rem;bottom:1rem;background:#1b2430;color:#fff;
      padding:.75rem 1rem;border:1px solid var(--border);border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.3);
      max-width:360px
    }
    .badge{display:inline-block;padding:.25rem .5rem;border-radius:999px;font-size:.75rem;background:#203040;color:#9fd2ff}
    .list{margin-top:.5rem;border-top:1px dashed var(--border)}
    .list-item{padding:.5rem 0;border-bottom:1px dashed var(--border);display:flex;justify-content:space-between;gap:.75rem}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    /* responsive */
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="title">Admin</div>
    <nav>
      #loginLogin</a>
      #productsProducts</a>
      #galleryGallery</a>
      #dashboardDashboard</a>
    </nav>
  </header>

  <!-- Toast -->
  <div id="toast" class="toast hidden"></div>

  <!-- Content -->
  <main>
    <!-- Panels container (we toggle these as tabs) -->
    <section id="panel-login" class="panel">
      <h2>Login</h2>
      <div class="row">
        <div style="flex:1">
          <label>Email</label>
          <input id="login-email" type="email" placeholder="admin@wykiesautomation.co.za" autocomplete="username" />
        </div>
        <div style="flex:1">
          <label>Password</label>
          <input id="login-password" type="password" placeholder="••••••••" autocomplete="current-password" />
        </div>
      </div>
      <div style="margin-top:.75rem" class="row">
        <button id="btn-login">Sign in</button>
        <span id="login-status" class="badge hidden"></span>
      </div>
      <p style="margin-top:.75rem;color:var(--muted)">
        This demo stores a temporary token in <span class="mono">localStorage</span>. Replace with your Apps Script / Flask JWT endpoint when ready.
      </p>
    </section>

    <section id="panel-products" class="panel hidden">
      <h2>Products</h2>
      <div class="grid">
        <div class="panel">
          <label>ID</label>
          <input id="prod-id" placeholder="WA-01" />
          <label>Name</label>
          <input id="prod-name" placeholder="Hybrid Gate Controller" />
          <label>Price (ZAR)</label>
          <input id="prod-price" type="number" placeholder="1499" />
          <label>Description</label>
          <textarea id="prod-desc" placeholder="Short description..."></textarea>
          <div style="margin-top:.75rem">
            <button id="btn-save-product">Save product</button>
          </div>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">Existing products</h3>
          <div id="product-list" class="list"></div>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">Actions</h3>
          <button class="secondary" id="btn-refresh-products">Refresh</button>
        </div>
      </div>
    </section>

    <section id="panel-gallery" class="panel hidden">
      <h2>Gallery</h2>
      <div class="grid">
        <div class="panel">
          <label>Image URL</label>
          <input id="gal-url" placeholder="https://..." />
          <label>ALT text</label>
          <input id="gal-alt" placeholder="Product photo – Hybrid Gate Controller" />
          <div style="margin-top:.75rem">
            <button id="btn-add-image">Add image</button>
          </div>
        </div>
        <div class="panel">
          <h3 style="margin-top:0">Images</h3>
          <div id="gallery-list" class="list"></div>
        </div>
        <div class="panel">
          <h3 style="margin-top:0">Preview</h3>
          <img id="gal-preview" src="" alt="" style="max-width:100%;border-radius:10px;border:1px solid var(--border)" />
        </div>
      </div>
    </section>

    <section id="panel-dashboard" class="panel hidden">
      <h2>Dashboard</h2>
      <div class="grid">
        <div class="panel">
          <h3 style="margin-top:0">Summary</h3>
          <div class="list">
            <div class="list-item"><div>Total products</div><div id="metric-products" class="badge">0</div></div>
            <div class="list-item"><div>Total gallery images</div><div id="metric-images" class="badge">0</div></div>
          </div>
        </div>
        <div class="panel">
          <h3 style="margin-top:0">Recent activity</h3>
          <div id="activity" class="list"></div>
        </div>
        <div class="panel">
          <h3 style="margin-top:0">Session</h3>
          <div class="list-item"><div>Logged in</div><div id="metric-auth" class="badge">No</div></div>
          <div style="margin-top:.75rem"><button class="secondary" id="btn-logout">Sign out</button></div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ---- Config loader (reads ./config.json in your repo) ----
    const App = {
      state: {
        token: null,
        config: { adminApi: "", sheetId: "", gallerySheet: "", productsSheet: "" },
        products: [],
        images: [],
        activity: []
      },
      async loadConfig() {
        try {
          const r = await fetch('./config.json', { cache:'no-cache' });
          if (!r.ok) throw new Error('config.json not found');
          App.state.config = await r.json();
        } catch (e) {
          toast('Could not load config.json. Using defaults.', 'warn');
        }
      }
    };

    // ---- UI helpers ----
    const $ = sel => document.querySelector(sel);
    function show(el){ el.classList.remove('hidden'); }
    function hide(el){ el.classList.add('hidden'); }
    function toast(msg, type='info'){
      const t = $('#toast');
      t.textContent = msg;
      t.classList.remove('hidden');
      t.style.borderColor = type==='success' ? 'var(--success)' : type==='warn' ? 'var(--warn)' : 'var(--border)';
      setTimeout(()=>t.classList.add('hidden'), 3000);
    }
    function addActivity(text){
      App.state.activity.unshift({ text, at: new Date().toLocaleString() });
      renderActivity();
    }

    // ---- Tab routing (hash-based) ----
    const panels = {
      login: $('#panel-login'),
      products: $('#panel-products'),
      gallery: $('#panel-gallery'),
      dashboard: $('#panel-dashboard')
    };
    const tabs = {
      login: $('#tab-login'),
      products: $('#tab-products'),
      gallery: $('#tab-gallery'),
      dashboard: $('#tab-dashboard')
    };
    function setActiveTab(name){
      // toggle panels
      Object.values(panels).forEach(hide);
      if (panels[name]) show(panels[name]);
      // toggle nav highlight
      Object.values(tabs).forEach(a => a.classList.remove('active'));
      if (tabs[name]) tabs[name].classList.add('active');
    }
    function navigate(){
      const hash = (location.hash || '#login').replace('#','');
      setActiveTab(hash);
    }
    window.addEventListener('hashchange', navigate);

    // ---- Auth (replace with your real API) ----
    async function login(){
      const email = $('#login-email').value.trim();
      const pass  = $('#login-password').value.trim();
      if (!email || !pass){ toast('Enter email and password','warn'); return; }
      try {
        // Example call to your backend:
        // const r = await fetch(App.state.config.adminApi + '?action=login', { method:'POST', body:new URLSearchParams({email, pass}) });
        // const data = await r.json();
        // if (data.ok) { App.state.token = data.token; } else { throw new Error(data.message); }

        // Demo token:
        App.state.token = 'demo-' + Math.random().toString(36).slice(2);
        localStorage.setItem('wykies.token', App.state.token);
        $('#login-status').textContent = 'Signed in'; show($('#login-status'));
        $('#metric-auth').textContent = 'Yes';
        toast('Signed in', 'success');
        addActivity('Signed in as ' + email);
        location.hash = '#dashboard';
      } catch(err){
        toast('Login failed: ' + err.message, 'warn');
      }
    }
    function logout(){
      App.state.token = null;
      localStorage.removeItem('wykies.token');
      $('#metric-auth').textContent = 'No';
      toast('Signed out', 'info');
      addActivity('Signed out');
      location.hash = '#login';
    }

    // ---- Products ----
    async function refreshProducts(){
      try {
        // Example: fetch products from Apps Script
        // const r = await fetch(App.state.config.adminApi + '?action=list_products');
        // App.state.products = await r.json();

        // Demo content (replace with API):
        App.state.products = App.state.products.length ? App.state.products : [
          { id:'WA-01', name:'Hybrid Gate Controller (GSM)', price:1499 },
          { id:'WA-02', name:'Hybrid Gate Controller (ESP32)', price:2499 }
        ];
        renderProducts();
        toast('Products refreshed', 'success');
      } catch(e){ toast('Failed to refresh products', 'warn'); }
    }
    function renderProducts(){
      const host = $('#product-list'); host.innerHTML = '';
      App.state.products.forEach(p=>{
        const row = document.createElement('div');
        row.className = 'list-item';
        row.innerHTML = `
          <div>
            <div><strong>${p.id}</strong> — ${p.name}</div>
            <div class="muted">R ${Number(p.price).toFixed(2)}</div>
          </div>
          <div class="row">
            <button class="secondary" onclick="deleteProduct('${p.id}')">Delete</button>
          </div>`;
        host.appendChild(row);
      });
      $('#metric-products').textContent = String(App.state.products.length);
    }
    async function saveProduct(){
      const id   = $('#prod-id').value.trim();
      const name = $('#prod-name').value.trim();
      const price= Number($('#prod-price').value.trim());
      const desc = $('#prod-desc').value.trim();
      if (!id || !name || !price){ toast('ID, Name, and Price are required','warn'); return; }

      try {
        // Example: send to Apps Script
        // const r = await fetch(App.state.config.adminApi + '?action=save_product', {
        //   method:'POST',
        //   headers: { 'Content-Type':'application/json' },
        //   body: JSON.stringify({ id, name, price, desc, token:App.state.token })
        // });
        // const data = await r.json();
        // if (!data.ok) throw new Error(data.message);

        // Demo: local add/update
        const idx = App.state.products.findIndex(p=>p.id===id);
        const prod = { id, name, price, desc };
        if (idx>=0) App.state.products[idx]=prod; else App.state.products.push(prod);
        renderProducts();
        addActivity(`Saved product ${id}`);
        toast('Product saved','success');
      } catch(e){ toast('Save failed: '+e.message,'warn'); }
    }
    function deleteProduct(id){
      App.state.products = App.state.products.filter(p=>p.id!==id);
      renderProducts();
      addActivity(`Deleted product ${id}`);
    }

    // ---- Gallery ----
    function renderImages(){
      const host = $('#gallery-list'); host.innerHTML = '';
      App.state.images.forEach((img, i)=>{
        const row = document.createElement('div');
        row.className = 'list-item';
        row.innerHTML = `
          <div><a href="${img.url}" target="_ class="muted">— ${img.alt}</span></div>
          <div class="row">
            <button class="secondary" onclick="previewImage('${img.url}','${img.alt}')">Preview</button>
            <button class="secondary" onclick="deleteImage(${i})">Delete</button>
          </div>`;
        host.appendChild(row);
      });
      $('#metric-images').textContent = String(App.state.images.length);
    }
    function previewImage(url, alt){
      const img = $('#gal-preview'); img.src=url; img.alt=alt; toast('Preview updated','info');
    }
    async function addImage(){
      const url = $('#gal-url').value.trim();
      const alt = $('#gal-alt').value.trim();
      if (!url){ toast('Image URL is required','warn'); return; }

      try {
        // Example: send to Apps Script
        // await fetch(App.state.config.adminApi + '?action=add_image', {
        //   method:'POST', headers:{'Content-Type':'application/json'},
        //   body: JSON.stringify({ url, alt, token:App.state.token })
        // });

        // Demo: local add
        App.state.images.push({ url, alt });
        renderImages();
        previewImage(url, alt);
        addActivity('Added image');
        toast('Image added','success');
      } catch(e){ toast('Add failed: '+e.message,'warn'); }
    }
    function deleteImage(i){
      App.state.images.splice(i,1);
      renderImages();
      addActivity('Deleted image');
    }

    // ---- Activity renderer ----
    function renderActivity(){
      const host = $('#activity'); host.innerHTML='';
      App.state.activity.slice(0,10).forEach(a=>{
        const row = document.createElement('div');
        row.className='list-item';
        row.innerHTML = `<div>${a.text}</div><div class="muted">${a.at}</div>`;
        host.appendChild(row);
      });
    }

    // ---- Wire up events ----
    $('#btn-login').addEventListener('click', login);
    $('#btn-logout').addEventListener('click', logout);
    $('#btn-save-product').addEventListener('click', saveProduct);
    $('#btn-refresh-products').addEventListener('click', refreshProducts);
    $('#btn-add-image').addEventListener('click', addImage);

    // ---- Boot ----
    (async function init(){
      await App.loadConfig();
      const saved = localStorage.getItem('wykies.token');
      if (saved){ App.state.token = saved; $('#metric-auth').textContent='Yes'; show($('#login-status')); $('#login-status').textContent='Signed in'; }
      await refreshProducts(); renderImages(); renderActivity();
      navigate(); // open the right tab based on hash
    })();
  </script>
</body>
</html>


/* --- Force-remove any pseudo-elements printing hrefs on links --- */
a::before,
a::after,
.nav a::before,
.nav a::after {
  content: "" !important;
  display: none !important;
}

