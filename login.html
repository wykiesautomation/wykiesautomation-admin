<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin Login — Wykies Automation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline';
                 script-src 'self'; base-uri 'none'; frame-ancestors 'none'; upgrade-insecure-requests">
  <link rel="stylesheet" href="./admin.css" />
</head>
<body>
  <main class="login-shell">
    <section class="panel login-card">
      <h1>Admin Login</h1>
      <p class="muted">Passphrase Sign In</p>
      <form id="f" autocomplete="off">
        <input id="pass" type="password" class="input" placeholder="Enter admin passphrase" required>
        <button class="btn btn-primary" type="submit">Sign In</button>
        <p id="msg" class="msg" role="alert" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <script>
    async function loadConfig(){
      try{
        const res = await fetch('./config/config.json').catch(()=>fetch('./config/config.example.json'));
        return await res.json();
      }catch(e){ return { scriptUrl:'' } }
    }
    async function login(pass){
      const cfg = await loadConfig();
      const url = cfg.scriptUrl + '/auth/login';
      const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ passphrase: pass }) });
      const data = await res.json();
      if(!data.ok) throw new Error(data.error?.message || 'Login failed');
      localStorage.setItem('adminToken', data.token);
      location.href = 'index.html';
    }
    document.getElementById('f').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const msg = document.getElementById('msg');
      msg.textContent='Signing in…';
      try{ await login(document.getElementById('pass').value.trim()); }
      catch(err){ msg.textContent = err.message; msg.classList.add('error'); }
    });
  </script>
</body>
</html>