<!doctype html><html lang='en'><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<title>Wykies Admin — Offline Demo</title>
<style>:root{--bg:#0F141C;--panel:#121826;--muted:#94A3B8;--text:#E5E7EB;--accent:#2F76FF;--ring:rgba(47,118,255,.35);--radius:14px}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
.topbar{height:56px;display:flex;align-items:center;padding:0 16px;background:#0B1220;border-bottom:1px solid #1F2937;position:sticky;top:0;z-index:10}
.topbar .brand{display:flex;gap:10px;align-items:center;font-weight:600}
.topbar .spacer{flex:1}
.badge{background:#1F2937;border:1px solid #263244;border-radius:999px;padding:6px 10px;font-size:12px;color:#C7D2FE}
button{background:#1F2937;color:var(--text);border:1px solid #243244;border-radius:10px;padding:8px 12px;cursor:pointer}
button.primary{background:var(--accent);border-color:transparent;color:white;box-shadow:0 0 0 0 rgba(0,0,0,0)}
button.primary:focus{outline:2px solid var(--ring)}
button.ghost{background:transparent;border-color:#243244}
.layout{display:grid;grid-template-columns:240px 1fr;min-height:calc(100vh - 56px)}
.sidenav{background:#0B1220;border-right:1px solid #1F2937;padding:12px;display:flex;flex-direction:column;gap:8px}
.nav-btn{width:100%;text-align:left;padding:10px 12px;border-radius:10px;border:1px solid #131c2b;background:#0E1626;color:#cbd5e1}
.nav-btn.active, .nav-btn:hover{background:#122036;border-color:#1d2b41}
.status{margin-top:auto;font-size:12px;color:#94a3b8;border-top:1px dashed #1F2937;padding-top:8px}
.content{padding:20px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
.card{background:var(--panel);border:1px solid #1F2937;border-radius:var(--radius);padding:16px}
.card .label{font-size:12px;color:var(--muted)}
.card .value{font-size:28px;font-weight:700}
.card .value.error{color:#FEB2B2}
.grid{width:100%;border-collapse:collapse;background:var(--panel);border:1px solid #1F2937;border-radius:12px;overflow:hidden}
.grid th,.grid td{padding:10px 12px;border-bottom:1px solid #1F2937}
.grid th{background:#0E1626;color:#A5B4FC;text-align:left}
.uploader{border:2px dashed #1F2937;border-radius:12px;padding:24px;text-align:center;color:#94a3b8}
.gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
.logview{background:#0B1220;border:1px solid #1F2937;border-radius:12px;padding:12px;min-height:220px;white-space:pre-wrap}
.tabs-inline{display:flex;gap:8px;margin-bottom:8px}
.subtab{background:#142034}
.actions{display:flex;gap:8px;align-items:center;margin-bottom:8px}
input{background:#0E1626;border:1px solid #1F2937;color:#E5E7EB;border-radius:10px;padding:8px 10px}
.build{margin-top:16px;color:#94a3b8;font-size:12px}
</style>
<body>
<script>window.CONFIG={OFFLINE_DEMO:true,API_BASE:'/api'};</script>

  <header class="topbar">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" fill="#2F76FF"/><path d="M6 13l3 3 9-9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <span>Wykies Admin</span>
    </div>
    <div class="spacer"></div>
    <div id="roleBadge" class="badge">Viewer</div>
    <button id="signOutBtn" class="ghost">Sign out</button>
  </header>
  <div class="layout">
    <nav class="sidenav">
      <button class="nav-btn active" data-tab="overview">Overview</button>
      <button class="nav-btn" data-tab="products">Products</button>
      <button class="nav-btn" data-tab="gallery">Gallery</button>
      <button class="nav-btn" data-tab="payments">Payments</button>
      <button class="nav-btn" data-tab="logs">Logs</button>
      <div class="status" id="statusBar">Connecting CMS…</div>
    </nav>
    <main class="content">
      <section id="overview" class="tab active">
        <h1>Operational Overview</h1>
        <div class="cards">
          <div class="card"><div class="label">Products</div><div id="statProducts" class="value">–</div></div>
          <div class="card"><div class="label">Payments (today)</div><div id="statPayments" class="value">–</div></div>
          <div class="card"><div class="label">Gallery Images</div><div id="statGallery" class="value">–</div></div>
          <div class="card"><div class="label">Errors</div><div id="statErrors" class="value error">0</div></div>
        </div>
        <div class="build">Build: <span id="buildId"></span></div>
      </section>
      <section id="products" class="tab">
        <h1>Products</h1>
        <div class="actions">
          <button id="btnAddProduct" class="primary">Add Product</button>
          <input id="filterProducts" placeholder="Filter…"/>
        </div>
        <table class="grid" id="gridProducts"> 
          <thead><tr><th>ID</th><th>Title</th><th>Price (incl. VAT)</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>
      <section id="gallery" class="tab">
        <h1>Gallery</h1>
        <div class="uploader" id="dropZone">Drag & drop images (≤200KB)</div>
        <div class="gallery" id="galleryGrid"></div>
      </section>
      <section id="payments" class="tab">
        <h1>Payments</h1>
        <table class="grid" id="gridPayments"> 
          <thead><tr><th>Date</th><th>Order</th><th>Email</th><th>Amount</th><th>Status</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>
      <section id="logs" class="tab">
        <h1>Logs</h1>
        <div class="tabs-inline">
          <button class="subtab active" data-log="price">Price Changes</button>
          <button class="subtab" data-log="system">System</button>
          <button class="subtab" data-log="itn">ITN</button>
        </div>
        <pre class="logview" id="logView">Loading…</pre>
      </section>
    </main>
  </div>

  <script src="./config.js"></script>
  <script src="./app.js"></script>

<script>/* Admin SPA JS */
const qs = sel => document.querySelector(sel);
const qsa = sel => Array.from(document.querySelectorAll(sel));

const state = {
  role: 'Viewer',
  offline: true,
  buildId: 'WA-WEB-20260102-165645',
};

// Tabs
qsa('.nav-btn').forEach(btn => btn.addEventListener('click', () => {
  qsa('.nav-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  qsa('.tab').forEach(p=>p.classList.remove('active'));
  qs('#'+btn.dataset.tab).classList.add('active');
}));

function setStatus(text){ qs('#statusBar').textContent = text; }
function setRole(role){ state.role = role; qs('#roleBadge').textContent = role; }

async function boot(){
  qs('#buildId').textContent = state.buildId;
  setStatus('Loading build…');
  try {
    if (window.CONFIG) {
      state.offline = !!window.CONFIG.OFFLINE_DEMO;
    }
  } catch(e){}

  if (state.offline) {
    setRole('Admin');
    setStatus('OFFLINE DEMO mode');
    loadMock();
  } else {
    setStatus('Connecting to CMS…');
    await refreshAll();
  }
}

function loadMock(){
  const products = [
    {id:'WA-01', title:'ESP32 Gate Opener (Wi‑Fi/BLE)', price:1499, status:'Enabled'},
    {id:'WA-02', title:'GSM Gate Opener (Nano)', price:2499, status:'Enabled'},
    {id:'WA-03', title:'Hybrid Gate Controller', price:6499, status:'Draft'}
  ];
  renderProducts(products);
  qs('#statProducts').textContent = String(products.length);
  qs('#statPayments').textContent = '0';
  qs('#statGallery').textContent = '0';
  qs('#logView').textContent = '[DEMO] No logs yet';
}

async function refreshAll(){
  const [products, payments] = await Promise.all([
    api('/products'),
    api('/payments')
  ]);
  renderProducts(products.data || []);
  qs('#statProducts').textContent = String((products.data||[]).length);
  qs('#statPayments').textContent = String((payments.data||[]).filter(p=>p.date && new Date(p.date).toDateString()===new Date().toDateString()).length);
}

function renderProducts(rows){
  const tb = qs('#gridProducts tbody');
  tb.innerHTML = '';
  rows.forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.title}</td><td>R ${Number(r.price).toLocaleString()}</td><td>${r.status||'Enabled'}</td><td><button class="ghost">Edit</button></td>`;
    tb.appendChild(tr);
  });
}

async function api(path, opts={}){
  const base = (window.CONFIG && window.CONFIG.API_BASE) || '/api';
  const url = base + path;
  const res = await fetch(url, {
    method: opts.method||'GET',
    headers: Object.assign({'Content-Type':'application/json'}, opts.headers||{}),
    body: opts.body ? JSON.stringify(opts.body) : undefined,
    credentials: 'omit'
  });
  if (!res.ok) throw new Error('API '+res.status);
  return await res.json();
}

window.addEventListener('load', boot);
</script>
</body></html>